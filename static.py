import pickle
import json
import os 
import sys
import csv
################################### From README ############################
#The function featurefoo extracts the feature from a single file
#The features considered in feature extraction Phase were from DOS_Header
#Optional header , PE Section and API's 
#The API's are the top 400 API's extracted after applying tf-idf on all
#the present API's in the documents this gave me the modt relevant API's
#total thousands of API's which were called in the program. 
#Here Feature engineering is mainly the tf-idf part and finding the apt 
#subpart of sections which should be used as features.

#Here I considered it as a multiclass classification task 
#considered 4 classes to classify the data namely 
#1>Benign 
#2>packed Benign
#3>Malware
#4>packed Malware
#Trained the model on the give above 4 classes
#Then finally if the file classified as Benign malware, Benign it was 
#classified as Benign and if it was classified as Malware , Malware packed
#then it was classified as Malware.
#So using the above method i converted multiclass output into binary output.

############################################################################

def featurefoo(address):
    
    #strin is list of API's
    #strin1 is in which category an API is belonging to.
    #dictio is the dictionary of all the features that are to be extracted.
    
    strin = ['GetProcAddress', 'LoadLibraryA', 'WriteFile', 'ExitProcess', 'CloseHandle', 'VirtualAlloc', 'GetCommandLineA', 'MessageBoxA', 'GetLastError', 'VirtualProtect', 'MultiByteToWideChar', 'VirtualFree', 'GetModuleHandleW', 'GetModuleHandleA', 'ReadFile', 'GetDC', 'GetModuleFileNameA', 'ShellExecuteA', 'Sleep', 'CoTaskMemFree', 'GetStdHandle', 'FreeSid', 'WideCharToMultiByte', 'BitBlt', 'GetCurrentProcess', 'timeGetTime', 'SetEndOfFile', 'WinVerifyTrust', 'GetModuleFileNameW', 'InternetOpenW', 'RtlUnwind', 'CryptMsgClose', 'GetACP', 'GdipFree', 'GetFileType', 'CreateEnvironmentBlock', 'SetLastError', 'AlphaBlend', 'GetCPInfo', 'GetMappedFileNameA', 'UnhandledExceptionFilter', 'GetUserNameExW', 'GetOEMCP', 'SHDeleteKeyW', 'GetCurrentThreadId', 'SafeArrayGetVartype', 'HeapAlloc', 'RegCloseKey', 'TlsSetValue', 'SHGetMalloc', 'HeapFree', 'RegEnumKeyA', 'TlsGetValue', '_lopen', 'EnterCriticalSection', 'RaiseException', 'DeleteCriticalSection', 'VariantChangeTypeEx', 'GetStringTypeW', 'InitCommonControlsEx', 'LeaveCriticalSection', 'wsprintfA', 'FreeEnvironmentStringsW', 'GlobalAlloc', 'GetEnvironmentStringsW', 'ExitThread', 'HeapReAlloc', 'Arc', 'LCMapStringW', 'CreateThread', 'TerminateProcess', 'ChooseColorA', 'QueryPerformanceCounter', 'ImmGetContext', 'CreateFileW', 'VariantCopy', 'LoadLibraryExW', 'tan', 'SetUnhandledExceptionFilter', 'LocalAlloc', 'SetStdHandle', 'SysFreeString', 'InitializeCriticalSectionAndSpinCount', 'CoInitialize', 'GetProcessHeap', 'VerQueryValueW', 'TlsAlloc', 'InitCommonControls', 'FlushFileBuffers', 'inet_addr', 'GetCurrentProcessId', 'VerQueryValueA', 'GetSystemTimeAsFileTime', 'SaveDC', 'HeapSize', 'exit', 'TlsFree', 'lstrlenA', 'IsValidCodePage', 'closesocket', 'LoadLibraryW', 'GetErrorInfo', 'IsProcessorFeaturePresent', 'VirtualProtectEx', 'DecodePointer', 'send', 'IsDebuggerPresent', 'SendMessageA', 'SetFilePointerEx', 'GlobalFree', 'WriteConsoleW', 'CreateFontA', 'GetConsoleMode', 'GetLocalTime', 'GetStartupInfoW', 'SetTimer', 'GetModuleHandleExW', 'CreateFileA', 'GetConsoleCP', 'ShellExecuteW', 'EncodePointer', 'Escape', 'OutputDebugStringW', 'GetFileTitleA', 'AreFileApisANSI', 'LoadLibraryExA', 'ReadConsoleW', 'LocalFree', 'SetFilePointer', 'PathIsUNCA', 'FreeLibrary', 'WSAStartup', 'GetFileSize', 'RegOpenKeyA', 'FindClose', 'ImageList_Add', 'WaitForSingleObject', 'LoadIconA', 'GetExitCodeProcess', 'WinHttpOpen', 'GetTickCount', 'FreeContextBuffer', 'RegQueryValueExA', 'GetAce', 'DestroyWindow', 'GetSystemTime', 'GetVersion', '__WSAFDIsSet', 'DeleteFileA', 'GradientFill', 'RegOpenKeyExA', 'SendARP', 'SetErrorMode', 'PropertySheetW', 'GetCommandLineW', 'GetProcessImageFileNameW', 'ShowWindow', 'CertCloseStore', 'ExitWindowsEx', 'PathCanonicalizeW', 'GetFileAttributesA', 'StackWalk64', 'GetSystemMetrics', 'VarUI4FromStr', 'CreateDirectoryA', 'InternetOpenA', 'CreateProcessA', 'VariantClear', 'VirtualQuery', 'std', 'DispatchMessageA', 'GetStringTypeA', 'GetDlgItem', 'SetBkMode', 'GetWindowsDirectoryA', 'LoadCursorA', 'EndDialog', 'setsockopt', 'GetWindowRect', 'NetWkstaGetInfo', 'PostQuitMessage', 'DeleteObject', 'CreateWindowExA', 'PtInRect', 'SetWindowPos', 'LCMapStringA', 'SetWindowLongA', 'GetPropA', 'RemoveDirectoryA', 'CharNextW', 'SetFileTime', 'OffsetRect', 'PeekMessageA', 'InitializeCriticalSection', 'FindFirstFileA', 'MultinetGetConnectionPerformanceW', 'EnableWindow', 'RegFlushKey', 'SetForegroundWindow', 'FindWindowA', 'GetStartupInfoA', 'BeginPaint', 'GetClientRect', 'SetWindowTextA', 'GetFullPathNameA', 'gluNewTess', 'CoCreateInstance', 'PostMessageW', 'SelectObject', 'SHChangeNotify', 'GetDeviceCaps', 'GetVersionExA', 'GetTempPathA', 'ShellExecuteExW', 'EndPaint', 'AddAce', 'MulDiv', 'DefFrameProcW', 'GetSystemInfo', 'PostMessageA', 'InvalidateRect', 'SetPropA', 'CharNextA', 'CreateMutexA', 'GlobalLock', 'HeapCreate', 'GlobalUnlock', 'ResumeThread', 'RegSetValueExA', 'IsValidLocale', 'FindNextFileA', 'GetWindowThreadProcessId', 'IsWindow', 'BringWindowToTop', 'SetTextColor', 'WriteProcessMemory', 'GetSysColor', 'DeleteDC', 'SetCursor', 'WNetAddConnection2A', 'RegQueryValueExW', 'SetHandleCount', 'OpenProcessToken', 'socket', 'lstrcatA', 'OleDraw', 'CallWindowProcA', 'GetEnvironmentStrings', 'TranslateMessage', 'GetCurrentThread', 'lstrcmpiA', 'GetWindowTextLengthA', 'ScreenToClient', 'SysAllocString', 'RegOpenKeyExW', 'HeapDestroy', 'LoadResource', 'SetEnvironmentVariableA', 'LockResource', 'OpenMutexA', 'SetBkColor', 'FreeEnvironmentStringsA', 'GetWindowLongA', 'CreateCompatibleDC', 'lstrcpynA', 'GetEnvironmentVariableA', 'SetFileAttributesA', 'SetThreadPriority', 'IsWindowVisible', 'DrawFrameControl', 'DefWindowProcA', 'GetMenu', 'SizeofResource', 'GetMessageA', 'FillRect', 'CharToOemA', 'CharPrevA', 'WindowFromPoint', 'lstrcmpA', 'GetThreadContext', 'IsWindowEnabled', 'AddFontResourceW', 'GetSystemDirectoryA', 'EnumThreadWindows', 'SHGetSpecialFolderLocation', 'ReadProcessMemory', 'RegCreateKeyExA', 'KillTimer', 'TrackPopupMenu', 'DestroyCursor', 'GetTempFileNameA', 'GetFileVersionInfoSizeA', 'SetCurrentDirectoryA', 'RegisterClassA', 'EnableMenuItem', 'DestroyIcon', 'OleInitialize', 'RegOpenKeyW', 'CreatePopupMenu', 'DragObject', 'DeleteFileW', 'UpdateWindow', 'DialogBoxParamA', 'GetWindowLongW', 'OleUninitialize', 'SuspendThread', 'GetMessagePos', 'GetMenuContextHelpId', 'GetDiskFreeSpaceA', 'CreatePalette', 'GetLocaleInfoA', 'CreatePipe', 'SystemParametersInfoA', 'SelectPalette', 'CreateDirectoryW', 'RealizePalette', 'SetDlgItemTextA', 'CreateDIBitmap', 'MoveFileA', 'SetClassLongA', 'GetSystemMenu', 'GetAsyncKeyState', 'CompareFileTime', 'RegRestoreKeyW', 'InterlockedExchange', 'GetTopWindow', 'GetShortPathNameA', 'DuplicateHandle', 'CopyFileA', 'RegQueryValueW', 'RegDeleteValueA', 'CreateDialogIndirectParamA', 'OpenClipboard', 'ContinueDebugEvent', 'CloseClipboard', 'CreateDCA', 'CreateFontIndirectA', 'WaitForDebugEvent', 'EmptyClipboard', 'DebugActiveProcess', 'ImageList_Create', 'ReleaseMutex', 'SetClipboardData', 'CreateFileMappingA', 'FormatMessageW', 'RealChildWindowFromPoint', 'lstrlenW', 'ShellExecuteExA', 'GetDlgItemTextA', 'MapViewOfFile', 'SetEvent', 'CompareStringA', 'ExpandEnvironmentStringsA', 'WaitForInputIdle', 'SHGetPathFromIDListA', 'GetForegroundWindow', 'DrawTextA', 'FlushConsoleInputBuffer', 'ImageList_Destroy', 'CreateIoCompletionPort', 'GetLocaleInfoW', 'DllRegisterServer', 'CheckDlgButton', 'CopyRect', 'GetPrivateProfileStringA', 'GetCursorInfo', 'CreateBrushIndirect', 'recv', 'LoadStringW', 'GetTimeZoneInformation', 'CreateDialogParamA', 'GetDesktopWindow', 'RegDeleteKeyA', 'CompareStringW', 'GetThreadLocale', 'lstrcpyA', 'GetFileVersionInfoA', 'ArcTo', 'WritePrivateProfileStringA', 'ZwLoadDriver', 'LoadBitmapA', 'DragFinish', 'MessageBoxW', 'LineTo', 'FindFirstFileW', 'FoldStringW', 'GetFileAttributesW', 'VirtualQueryEx', 'RegEnumValueA', 'DrawEdge', 'GetClassInfoA', 'GetWindowInfo', 'ImageList_AddMasked', 'UnionRect', 'SHBrowseForFolderA', 'MoveWindow', 'RemoveDirectoryW', 'char_traits', 'LoadImageA', 'DU']
    strin1 = ['NumberOfSections:','Machine:','SizeOfOptionalHeader:','MajorLinkerVersion:','MinorLinkerVersion:','SizeOfCode:','SizeOfInitializedData:','SizeOfUninitializedData:','AddressOfEntryPoint:','BaseOfCode:','BaseOfData:','ImageBase:','SectionAlignment:','FileAlignment:','MajorOperatingSystemVersion:','MinorOperatingSystemVersion:','MajorImageVersion:','MinorImageVersion:','MajorSubsystemVersion:','MinorSubsystemVersion:','SizeOfImage:','SizeOfHeaders:','CheckSum:','Subsystem:','SizeOfStackReserve:','SizeOfStackCommit:','SizeOfHeapReserve:','SizeOfHeapCommit:','LoaderFlags:','NumberOfRvaAndSizes:','e_cblp:', 'e_cp:', 'e_cparhdr:', 'e_maxalloc:', 'e_sp:', 'e_lfanew:']
    dictio = {'GetProcAddress':0,'LoadLibraryA':0,'WriteFile':0,'ExitProcess':0,'CloseHandle':0,'VirtualAlloc':0,'GetCommandLineA':0,'MessageBoxA':0,'GetLastError':0,'VirtualProtect':0,'MultiByteToWideChar':0,'VirtualFree':0,'GetModuleHandleW':0,'GetModuleHandleA':0,'ReadFile':0,'GetDC':0,'GetModuleFileNameA':0,'ShellExecuteA':0,'Sleep':0,'CoTaskMemFree':0,'GetStdHandle':0,'FreeSid':0,'WideCharToMultiByte':0,'BitBlt':0,'GetCurrentProcess':0,'timeGetTime':0,'SetEndOfFile':0,'WinVerifyTrust':0,'GetModuleFileNameW':0,'InternetOpenW':0,'RtlUnwind':0,'CryptMsgClose':0,'GetACP':0,'GdipFree':0,'GetFileType':0,'CreateEnvironmentBlock':0,'SetLastError':0,'AlphaBlend':0,'GetCPInfo':0,'GetMappedFileNameA':0,'UnhandledExceptionFilter':0,'GetUserNameExW':0,'GetOEMCP':0,'SHDeleteKeyW':0,'GetCurrentThreadId':0,'SafeArrayGetVartype':0,'HeapAlloc':0,'RegCloseKey':0,'TlsSetValue':0,'SHGetMalloc':0,'HeapFree':0,'RegEnumKeyA':0,'TlsGetValue':0,'_lopen':0,'EnterCriticalSection':0,'RaiseException':0,'DeleteCriticalSection':0,'VariantChangeTypeEx':0,'GetStringTypeW':0,'InitCommonControlsEx':0,'LeaveCriticalSection':0,'wsprintfA':0,'FreeEnvironmentStringsW':0,'GlobalAlloc':0,'GetEnvironmentStringsW':0,'ExitThread':0,'HeapReAlloc':0,'Arc':0,'LCMapStringW':0,'CreateThread':0,'TerminateProcess':0,'ChooseColorA':0,'QueryPerformanceCounter':0,'ImmGetContext':0,'CreateFileW':0,'VariantCopy':0,'LoadLibraryExW':0,'tan':0,'SetUnhandledExceptionFilter':0,'LocalAlloc':0,'SetStdHandle':0,'SysFreeString':0,'InitializeCriticalSectionAndSpinCount':0,'CoInitialize':0,'GetProcessHeap':0,'VerQueryValueW':0,'TlsAlloc':0,'InitCommonControls':0,'FlushFileBuffers':0,'inet_addr':0,'GetCurrentProcessId':0,'VerQueryValueA':0,'GetSystemTimeAsFileTime':0,'SaveDC':0,'HeapSize':0,'exit':0,'TlsFree':0,'lstrlenA':0,'IsValidCodePage':0,'closesocket':0,'LoadLibraryW':0,'GetErrorInfo':0,'IsProcessorFeaturePresent':0,'VirtualProtectEx':0,'DecodePointer':0,'send':0,'IsDebuggerPresent':0,'SendMessageA':0,'SetFilePointerEx':0,'GlobalFree':0,'WriteConsoleW':0,'CreateFontA':0,'GetConsoleMode':0,'GetLocalTime':0,'GetStartupInfoW':0,'SetTimer':0,'GetModuleHandleExW':0,'CreateFileA':0,'GetConsoleCP':0,'ShellExecuteW':0,'EncodePointer':0,'Escape':0,'OutputDebugStringW':0,'GetFileTitleA':0,'AreFileApisANSI':0,'LoadLibraryExA':0,'ReadConsoleW':0,'LocalFree':0,'SetFilePointer':0,'PathIsUNCA':0,'FreeLibrary':0,'WSAStartup':0,'GetFileSize':0,'RegOpenKeyA':0,'FindClose':0,'ImageList_Add':0,'WaitForSingleObject':0,'LoadIconA':0,'GetExitCodeProcess':0,'WinHttpOpen':0,'GetTickCount':0,'FreeContextBuffer':0,'RegQueryValueExA':0,'GetAce':0,'DestroyWindow':0,'GetSystemTime':0,'GetVersion':0,'__WSAFDIsSet':0,'DeleteFileA':0,'GradientFill':0,'RegOpenKeyExA':0,'SendARP':0,'SetErrorMode':0,'PropertySheetW':0,'GetCommandLineW':0,'GetProcessImageFileNameW':0,'ShowWindow':0,'CertCloseStore':0,'ExitWindowsEx':0,'PathCanonicalizeW':0,'GetFileAttributesA':0,'StackWalk64':0,'GetSystemMetrics':0,'VarUI4FromStr':0,'CreateDirectoryA':0,'InternetOpenA':0,'CreateProcessA':0,'VariantClear':0,'VirtualQuery':0,'std':0,'DispatchMessageA':0,'GetStringTypeA':0,'GetDlgItem':0,'SetBkMode':0,'GetWindowsDirectoryA':0,'LoadCursorA':0,'EndDialog':0,'setsockopt':0,'GetWindowRect':0,'NetWkstaGetInfo':0,'PostQuitMessage':0,'DeleteObject':0,'CreateWindowExA':0,'PtInRect':0,'SetWindowPos':0,'LCMapStringA':0,'SetWindowLongA':0,'GetPropA':0,'RemoveDirectoryA':0,'CharNextW':0,'SetFileTime':0,'OffsetRect':0,'PeekMessageA':0,'InitializeCriticalSection':0,'FindFirstFileA':0,'MultinetGetConnectionPerformanceW':0,'EnableWindow':0,'RegFlushKey':0,'SetForegroundWindow':0,'FindWindowA':0,'GetStartupInfoA':0,'BeginPaint':0,'GetClientRect':0,'SetWindowTextA':0,'GetFullPathNameA':0,'gluNewTess':0,'CoCreateInstance':0,'PostMessageW':0,'SelectObject':0,'SHChangeNotify':0,'GetDeviceCaps':0,'GetVersionExA':0,'GetTempPathA':0,'ShellExecuteExW':0,'EndPaint':0,'AddAce':0,'MulDiv':0,'DefFrameProcW':0,'GetSystemInfo':0,'PostMessageA':0,'InvalidateRect':0,'SetPropA':0,'CharNextA':0,'CreateMutexA':0,'GlobalLock':0,'HeapCreate':0,'GlobalUnlock':0,'ResumeThread':0,'RegSetValueExA':0,'IsValidLocale':0,'FindNextFileA':0,'GetWindowThreadProcessId':0,'IsWindow':0,'BringWindowToTop':0,'SetTextColor':0,'WriteProcessMemory':0,'GetSysColor':0,'DeleteDC':0,'SetCursor':0,'WNetAddConnection2A':0,'RegQueryValueExW':0,'SetHandleCount':0,'OpenProcessToken':0,'socket':0,'lstrcatA':0,'OleDraw':0,'CallWindowProcA':0,'GetEnvironmentStrings':0,'TranslateMessage':0,'GetCurrentThread':0,'lstrcmpiA':0,'GetWindowTextLengthA':0,'ScreenToClient':0,'SysAllocString':0,'RegOpenKeyExW':0,'HeapDestroy':0,'LoadResource':0,'SetEnvironmentVariableA':0,'LockResource':0,'OpenMutexA':0,'SetBkColor':0,'FreeEnvironmentStringsA':0,'GetWindowLongA':0,'CreateCompatibleDC':0,'lstrcpynA':0,'GetEnvironmentVariableA':0,'SetFileAttributesA':0,'SetThreadPriority':0,'IsWindowVisible':0,'DrawFrameControl':0,'DefWindowProcA':0,'GetMenu':0,'SizeofResource':0,'GetMessageA':0,'FillRect':0,'CharToOemA':0,'CharPrevA':0,'WindowFromPoint':0,'lstrcmpA':0,'GetThreadContext':0,'IsWindowEnabled':0,'AddFontResourceW':0,'GetSystemDirectoryA':0,'EnumThreadWindows':0,'SHGetSpecialFolderLocation':0,'ReadProcessMemory':0,'RegCreateKeyExA':0,'KillTimer':0,'TrackPopupMenu':0,'DestroyCursor':0,'GetTempFileNameA':0,'GetFileVersionInfoSizeA':0,'SetCurrentDirectoryA':0,'RegisterClassA':0,'EnableMenuItem':0,'DestroyIcon':0,'OleInitialize':0,'RegOpenKeyW':0,'CreatePopupMenu':0,'DragObject':0,'DeleteFileW':0,'UpdateWindow':0,'DialogBoxParamA':0,'GetWindowLongW':0,'OleUninitialize':0,'SuspendThread':0,'GetMessagePos':0,'GetMenuContextHelpId':0,'GetDiskFreeSpaceA':0,'CreatePalette':0,'GetLocaleInfoA':0,'CreatePipe':0,'SystemParametersInfoA':0,'SelectPalette':0,'CreateDirectoryW':0,'RealizePalette':0,'SetDlgItemTextA':0,'CreateDIBitmap':0,'MoveFileA':0,'SetClassLongA':0,'GetSystemMenu':0,'GetAsyncKeyState':0,'CompareFileTime':0,'RegRestoreKeyW':0,'InterlockedExchange':0,'GetTopWindow':0,'GetShortPathNameA':0,'DuplicateHandle':0,'CopyFileA':0,'RegQueryValueW':0,'RegDeleteValueA':0,'CreateDialogIndirectParamA':0,'OpenClipboard':0,'ContinueDebugEvent':0,'CloseClipboard':0,'CreateDCA':0,'CreateFontIndirectA':0,'WaitForDebugEvent':0,'EmptyClipboard':0,'DebugActiveProcess':0,'ImageList_Create':0,'ReleaseMutex':0,'SetClipboardData':0,'CreateFileMappingA':0,'FormatMessageW':0,'RealChildWindowFromPoint':0,'lstrlenW':0,'ShellExecuteExA':0,'GetDlgItemTextA':0,'MapViewOfFile':0,'SetEvent':0,'CompareStringA':0,'ExpandEnvironmentStringsA':0,'WaitForInputIdle':0,'SHGetPathFromIDListA':0,'GetForegroundWindow':0,'DrawTextA':0,'FlushConsoleInputBuffer':0,'ImageList_Destroy':0,'CreateIoCompletionPort':0,'GetLocaleInfoW':0,'DllRegisterServer':0,'CheckDlgButton':0,'CopyRect':0,'GetPrivateProfileStringA':0,'GetCursorInfo':0,'CreateBrushIndirect':0,'recv':0,'LoadStringW':0,'GetTimeZoneInformation':0,'CreateDialogParamA':0,'GetDesktopWindow':0,'RegDeleteKeyA':0,'CompareStringW':0,'GetThreadLocale':0,'lstrcpyA':0,'GetFileVersionInfoA':0,'ArcTo':0,'WritePrivateProfileStringA':0,'ZwLoadDriver':0,'LoadBitmapA':0,'DragFinish':0,'MessageBoxW':0,'LineTo':0,'FindFirstFileW':0,'FoldStringW':0,'GetFileAttributesW':0,'VirtualQueryEx':0,'RegEnumValueA':0,'DrawEdge':0,'GetClassInfoA':0,'GetWindowInfo':0,'ImageList_AddMasked':0,'UnionRect':0,'SHBrowseForFolderA':0,'MoveWindow':0,'RemoveDirectoryW':0,'char_traits':0,'LoadImageA':0,'DU':0,'NumberOfSections':0,'Machine':0,'SizeOfOptionalHeader':0,'MajorLinkerVersion':0,'MinorLinkerVersion':0,'SizeOfCode':0,'SizeOfInitializedData':0,'SizeOfUninitializedData':0,'AddressOfEntryPoint':0,'BaseOfCode':0,'BaseOfData':0,'ImageBase':0,'SectionAlignment':0,'FileAlignment':0,'MajorOperatingSystemVersion':0,'MinorOperatingSystemVersion':0,'MajorImageVersion':0,'MinorImageVersion':0,'MajorSubsystemVersion':0,'MinorSubsystemVersion':0,'SizeOfImage':0,'SizeOfHeaders':0,'CheckSum':0,'Subsystem':0,'SizeOfStackReserve':0,'SizeOfStackCommit':0,'SizeOfHeapReserve':0,'SizeOfHeapCommit':0,'LoaderFlags':0,'NumberOfRvaAndSizes':0,'e_cblp':0,'e_cp':0,'e_cparhdr':0,'e_maxalloc':0,'e_sp':0,'e_lfanew':0}
    
    with open(address, "rb") as f:
         
         for line in f.readlines():
            
            line  = line.decode('utf-8','ignore')
            line1 = line
            
            if(line.find("Resource directory") != -1):
                break
            
            if(line.find("dll") != -1) or (line.find("DLL") != -1):
                    str1 = line.split()
                    str2 = str1[0].split(".")
                    if(len(str2) >2):
                        if(str2[2] in strin):
                            dictio[str2[2]] = 1
            line1 = line1.split()
           
            if(len(line1) == 4):
                str1 = line1[2]
                
                if(str1 in strin1):
                    dictio[str1[:-1]] =int(line1[3][2:], 16)
    
    return list(dictio.values()) 


def staticfoo(direc):
    
    filename = "Staticmodel"
    model =  pickle.load(open(filename, 'rb'))
    finalist = []
    topics = ['File_Hash', 'Predicted Label']
    for files in os.listdir(direc):
        lis= []
        X = featurefoo(os.path.join(os.path.join(direc,files), 'Structure_Info.txt'))
        y = model.predict([X])
        lis.append(files)    
        if(y == 2 or y == 3):
            y = 'M'
        else:
            y = 'B'
        lis.append(y)
        finalist.append(lis)
    
    with open("static.csv", 'w', newline='') as myfile:
        wr = csv.writer(myfile, quoting=csv.QUOTE_ALL)
        wr.writerow(topics)
        for i in range(len(finalist)):
            wr.writerow(finalist[i])

def main():
    file = sys.argv[1]
    print(file)
    staticfoo(file)

if __name__ == '__main__':
    main()